var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,l,e){a!=Array.prototype&&a!=Object.prototype&&(a[l]=e.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,l,e,q){if(l){e=$jscomp.global;a=a.split(".");for(q=0;q<a.length-1;q++){var x=a[q];x in e||(e[x]={});e=e[x]}a=a[a.length-1];q=e[a];l=l(q);l!=q&&null!=l&&$jscomp.defineProperty(e,a,{configurable:!0,writable:!0,value:l})}};
$jscomp.polyfill("Array.from",function(a){return a?a:function(a,e,q){e=null!=e?e:function(a){return a};var l=[],u="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];if("function"==typeof u){a=u.call(a);for(var y=0;!(u=a.next()).done;)l.push(e.call(q,u.value,y++))}else for(u=a.length,y=0;y<u;y++)l.push(e.call(q,a[y],y));return l}},"es6","es3");$jscomp.polyfill("Object.is",function(a){return a?a:function(a,e){return a===e?0!==a||1/a===1/e:a!==a&&e!==e}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,e){var l=this;l instanceof String&&(l=String(l));var x=l.length;e=e||0;for(0>e&&(e=Math.max(e+x,0));e<x;e++){var u=l[e];if(u===a||Object.is(u,a))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,l,e){if(null==a)throw new TypeError("The 'this' value for String.prototype."+e+" must not be null or undefined");if(l instanceof RegExp)throw new TypeError("First argument to String.prototype."+e+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,e){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,e||0)}},"es6","es3");
(function(){function a(b,g){A.material=B;B.uniforms.tSize.value=I;B.uniforms.texture.value=b.texture;v.setRenderTarget(g);v.render(J,L)}function l(){return new THREE.WebGLRenderTarget(n,n,{wrapS:THREE.ClampToEdgeWrapping,wrapT:THREE.ClampToEdgeWrapping,minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,type:THREE.FloatType,depthTest:!1,depthWrite:!1,depthBuffer:!1,stencilBuffer:!1})}function e(b,g){for(var a=new Float32Array(n*n*4),f=b.length,c=0;c<f;c++){var d=4*
c;a[d+0]=void 0===b[c].colors[g+0]?-1:b[c].colors[g+0];a[d+1]=void 0===b[c].colors[g+1]?-1:b[c].colors[g+1];a[d+2]=void 0===b[c].colors[g+2]?-1:b[c].colors[g+2];a[d+3]=void 0===b[c].colors[g+3]?-1:b[c].colors[g+3]}b={};b.texture=new THREE.DataTexture(a,n,n,THREE.RGBAFormat,THREE.FloatType);b.texture.minFilter=THREE.NearestFilter;b.texture.magFilter=THREE.NearestFilter;b.texture.needsUpdate=!0;b.texture.generateMipmaps=!1;b.texture.flipY=!1;return b}function q(b,a){for(var g=new Float32Array(n*n*4),
f=b.length,c=0;c<f;c++){var d=4*c;g[d+0]=void 0===b[c].faces[a+0]?-1:b[c].faces[a+0][0];g[d+1]=void 0===b[c].faces[a+0]?-1:b[c].faces[a+0][1];g[d+2]=void 0===b[c].faces[a+1]?-1:b[c].faces[a+1][0];g[d+3]=void 0===b[c].faces[a+1]?-1:b[c].faces[a+1][1]}b={};b.texture=new THREE.DataTexture(g,n,n,THREE.RGBAFormat,THREE.FloatType);b.texture.minFilter=THREE.NearestFilter;b.texture.magFilter=THREE.NearestFilter;b.texture.needsUpdate=!0;b.texture.generateMipmaps=!1;b.texture.flipY=!1;return b}function x(b){A.material=
C;C.uniforms.tSize.value=I;C.uniforms.cID.value=b%4;C.uniforms.tOriginal.value=F.texture;C.uniforms.tPosition.value=r.texture;C.uniforms.tConstraints.value=P[4>b?0:1].texture;v.setRenderTarget(w);v.render(J,L);b=r;r=w;w=b}function u(b,a){p=Math.ceil(Math.sqrt(a.attributes.position.count));var g=new THREE.MeshPhysicalMaterial({color:16767520,metalness:.1,roughness:.5,clearCoat:.8,clearCoatRoughness:.3,dithering:!0});g.onBeforeCompile=function(b){b.uniforms.tPosition={value:r.texture};b.uniforms.tNormal=
{value:X.texture};b.vertexShader="uniform sampler2D tPosition;\nuniform sampler2D tNormal;\n"+b.vertexShader;b.vertexShader=b.vertexShader.replace("#include <beginnormal_vertex>","vec3 transformed = texture2D( tPosition, position.xy ).xyz;\n\t\t\t vec3 objectNormal = normalize( texture2D( tNormal, position.xy ).xyz );\n\t\t\t");b.vertexShader=b.vertexShader.replace("#include <begin_vertex>","")};var f=new THREE.MeshDepthMaterial;f.onBeforeCompile=function(b){b.uniforms.tPosition={value:r.texture};
b.vertexShader="uniform sampler2D tPosition;\n"+b.vertexShader;b.vertexShader=b.vertexShader.replace("#include <begin_vertex>","vec3 transformed = texture2D( tPosition, position.xy ).xyz;")};for(var c=new Float32Array(p*p*3),d=0,e=p*p;d<e;d++){var k=3*d;c[k+0]=d%p/p+.5/p;c[k+1]=~~(d/p)/p+.5/p}d=new THREE.BufferGeometry;d.setIndex(a.index);d.addAttribute("position",new THREE.BufferAttribute(c,3));Q=new THREE.Mesh(d,g);Q.customDepthMaterial=f;Q.castShadow=!0;b.add(Q)}function y(b,a){Y=b;Z=a}function da(){requestAnimationFrame(da);
var b=fa.getElapsedTime();if(1<b&&4>b)for(var a=0;a<aa.length;a++){var e=aa[a];var f=(b-1)/3;var c=1>(f/=.5)?1.3*f*f*f:1.3*((f-=2)*f*f+2);e.intensity=c}A.material=G;G.uniforms.tSize.value=I;G.uniforms.tOriginal.value=F.texture;G.uniforms.tPrevious.value=M.texture;G.uniforms.tPosition.value=r.texture;v.setRenderTarget(w);v.render(J,L);b=M;M=r;r=w;w=b;for(b=0;60>b;b++){R.updating()&&(A.material=D,D.uniforms.tSize.value=I,D.uniforms.psel.value=R.psel,D.uniforms.mouse.value=R.mouse3d,D.uniforms.tOriginal.value=
F.texture,D.uniforms.tPosition.value=r.texture,v.setRenderTarget(w),v.render(J,L),a=r,r=w,w=a);for(a=0;8>a;a++)x(a);for(a=7;0<=a;a--)x(a)}A.material=E;E.uniforms.tSize.value=I;E.uniforms.tPosition.value=r.texture;E.uniforms.tFace1.value=H[0].texture;E.uniforms.tFace2.value=H[1].texture;E.uniforms.tFace3.value=H[2].texture;v.setRenderTarget(X);v.render(J,L);t.setRenderTarget(null);t.render(K,z)}var B=new THREE.RawShaderMaterial({uniforms:{tSize:{type:"v2"},texture:{type:"t"}},vertexShader:"\nprecision highp float;\n\nattribute vec2 position;\n\nvoid main() {\n\n\tgl_Position = vec4( position, vec2(1.0) );\n\n}\n",
fragmentShader:"\nprecision highp float;\n\nuniform vec2 tSize;\nuniform sampler2D texture;\n\nvoid main() {\n\n\tvec2 uv = gl_FragCoord.xy / tSize.xy;\n\tgl_FragColor = texture2D( texture, uv );\n\n}\n",fog:!1,lights:!1,depthWrite:!1,depthTest:!1}),G=B.clone();G.fragmentShader="\nprecision highp float;\n\nuniform vec2 tSize;\nuniform sampler2D tOriginal;\nuniform sampler2D tPrevious;\nuniform sampler2D tPosition;\n\nvoid main() {\n\n\tfloat dt2 = 0.000256;\n\n\tvec2 uv = gl_FragCoord.xy / tSize.xy;\n\n\tvec3 org = texture2D( tOriginal, uv ).xyz;\n\tvec3 prv = texture2D( tPrevious, uv ).xyz;\n\tvec3 pos = texture2D( tPosition, uv ).xyz;\n\n\tvec3 offset = ( org - pos ) * 28.5 * dt2 * 8.33333;\n\tvec3 disp = ( pos - prv ) * 0.91 + pos;\n\n\tgl_FragColor = vec4( disp + offset, 1.0 );\n\n}\n";
G.uniforms={tSize:{type:"v2"},tOriginal:{type:"t"},tPrevious:{type:"t"},tPosition:{type:"t"}};var D=B.clone();D.fragmentShader="\nprecision highp float;\n\nuniform int psel;\nuniform vec2 tSize;\nuniform vec3 mouse;\nuniform sampler2D tPosition;\nuniform sampler2D tOriginal;\n\nvec2 getUV( float id ) {\n\n\tfloat div = id / tSize.x;\n\tfloat d = floor( div );\n\n\tfloat y = d / tSize.x;\n\tfloat x = div - d;\n\n\tfloat off = 0.5 / tSize.x;\n\n\treturn vec2( x + off, y + off );\n\n}\n\nvoid main() {\n\n\tvec2 uv = gl_FragCoord.xy / tSize.xy;\n\tvec3 pos = texture2D( tPosition, uv ).xyz;\n\tvec3 org = texture2D( tOriginal, uv ).xyz;\n\n\tuv = getUV( float( psel ) );\n\tvec3 ref = texture2D( tOriginal, uv ).xyz;\n\n\tvec3 offset = mouse - ref;\n\n\tif ( distance( org, ref ) <= 15.0 )  {\n\n\t\tpos = org + offset;\n\n\t}\n\n\tgl_FragColor = vec4( pos, 1.0 );\n\n}\n";
D.uniforms={psel:{value:null},tSize:{type:"v2"},mouse:{type:"v3"},tOriginal:{type:"t"},tPosition:{type:"t"}};var C=B.clone();C.fragmentShader="\nprecision highp float;\n\nuniform int cID;\n\nuniform vec2 tSize;\n\nuniform sampler2D tPosition;\nuniform sampler2D tOriginal;\nuniform sampler2D tConstraints;\n\nvec2 getUV( float id ) {\n\n\tfloat div = id / tSize.x;\n\tfloat d = floor( div );\n\n\tfloat y = d / tSize.x;\n\tfloat x = div - d;\n\n\tfloat off = 0.5 / tSize.x;\n\n\treturn vec2( x + off, y + off );\n\n}\n\nvoid main() {\n\n\tvec2 uv = gl_FragCoord.xy / tSize.xy;\n\n\tvec3 orgA = texture2D( tOriginal, uv ).xyz;\n\tvec3 posA = texture2D( tPosition, uv ).xyz;\n\n\tfloat id;\n\n\tif ( cID == 0 )\n\t\tid = texture2D( tConstraints, uv )[0];\n\tif ( cID == 1 )\n\t\tid = texture2D( tConstraints, uv )[1];\n\tif ( cID == 2 )\n\t\tid = texture2D( tConstraints, uv )[2];\n\tif ( cID == 3 )\n\t\tid = texture2D( tConstraints, uv )[3];\n\n\tuv = getUV( id );\n\n\tvec3 orgB = texture2D( tOriginal, uv ).xyz;\n\tvec3 posB = texture2D( tPosition, uv ).xyz;\n\n\tvec3 offOrg = ( orgB - orgA );\n\tvec3 offCur = ( posB - posA );\n\n\tfloat restDist = dot( offOrg, offOrg );\n\tfloat curDist = dot( offCur, offCur );\n\n\tfloat diff = restDist / ( curDist + restDist ) - 0.5;\n\n\tif ( diff > 0.0 ) diff *= 0.2;\n\tif ( id == -1.0 ) diff = 0.0;\n\n\tposA -= offCur * diff * 0.52;\n\n\tgl_FragColor = vec4( posA, 1.0 );\n\n}\n";
C.uniforms={cID:{value:null},tSize:{type:"v2"},tOriginal:{type:"t"},tPosition:{type:"t"},tConstraints:{type:"t"}};var E=B.clone();E.fragmentShader="\nprecision highp float;\n\nuniform int cID;\n\nuniform vec2 tSize;\n\nuniform sampler2D tPosition;\nuniform sampler2D tFace1;\nuniform sampler2D tFace2;\nuniform sampler2D tFace3;\n\nvec2 getUV( float id ) {\n\n\tfloat div = id / tSize.x;\n\tfloat d = floor( div );\n\n\tfloat y = d / tSize.x;\n\tfloat x = div - d;\n\n\tfloat off = 0.5 / tSize.x;\n\n\treturn vec2( x + off, y + off );\n\n}\n\nvoid main() {\n\n\tvec2 uv = gl_FragCoord.xy / tSize.xy;\n\tvec3 a = texture2D( tPosition, uv ).xyz;\n\n\tvec2 uvB, uvC;\n\tvec3 normals, fNormal, b, c;\n\n\tfloat idB, idC;\n\n\t// face0\n\n\tidB = texture2D( tFace1, uv ).x;\n\tidC = texture2D( tFace1, uv ).y;\n\n\tuvB = getUV( idB );\n\tuvC = getUV( idC );\n\n\tb = texture2D( tPosition, uvB ).xyz;\n\tc = texture2D( tPosition, uvC ).xyz;\n\n\tfNormal = cross( ( c - b ), ( a - b ) );\n\n\tif ( idB != -1.0 ) normals += fNormal;\n\n\t// face1\n\n\tidB = texture2D( tFace1, uv ).z;\n\tidC = texture2D( tFace1, uv ).w;\n\n\tuvB = getUV( idB );\n\tuvC = getUV( idC );\n\n\tb = texture2D( tPosition, uvB ).xyz;\n\tc = texture2D( tPosition, uvC ).xyz;\n\n\tfNormal = cross( ( c - b ), ( a - b ) );\n\n\tif ( idB != - 1.0 ) normals += fNormal;\n\n\t// face2\n\n\tidB = texture2D( tFace2, uv ).x;\n\tidC = texture2D( tFace2, uv ).y;\n\n\tuvB = getUV( idB );\n\tuvC = getUV( idC );\n\n\tb = texture2D( tPosition, uvB ).xyz;\n\tc = texture2D( tPosition, uvC ).xyz;\n\n\tfNormal = cross( ( c - b ), ( a - b ) );\n\n\tif ( idB != - 1.0 ) normals += fNormal;\n\n\t// face3\n\n\tidB = texture2D( tFace2, uv ).z;\n\tidC = texture2D( tFace2, uv ).w;\n\n\tuvB = getUV( idB );\n\tuvC = getUV( idC );\n\n\tb = texture2D( tPosition, uvB ).xyz;\n\tc = texture2D( tPosition, uvC ).xyz;\n\n\tfNormal = cross( ( c - b ), ( a - b ) );\n\n\tif ( idB != - 1.0 ) normals += fNormal;\n\n\t// face4\n\n\tidB = texture2D( tFace3, uv ).x;\n\tidC = texture2D( tFace3, uv ).y;\n\n\tuvB = getUV( idB );\n\tuvC = getUV( idC );\n\n\tb = texture2D( tPosition, uvB ).xyz;\n\tc = texture2D( tPosition, uvC ).xyz;\n\n\tfNormal = cross( ( c - b ), ( a - b ) );\n\n\tif ( idB != - 1.0 ) normals += fNormal;\n\n\t// face5\n\n\tidB = texture2D( tFace3, uv ).z;\n\tidC = texture2D( tFace3, uv ).w;\n\n\tuvB = getUV( idB );\n\tuvC = getUV( idC );\n\n\tb = texture2D( tPosition, uvB ).xyz;\n\tc = texture2D( tPosition, uvC ).xyz;\n\n\tfNormal = cross( ( c - b ), ( a - b ) );\n\n\tif ( idB != - 1.0 ) normals += fNormal;\n\n\tgl_FragColor = vec4( normals, 1.0 );\n\n}\n";
E.uniforms={tSize:{type:"v2"},tPosition:{type:"t"},tFace1:{type:"t"},tFace2:{type:"t"},tFace3:{type:"t"}};var n,R,v,A,w,X,F,M,r,P,H,I=new THREE.Vector2,J=new THREE.Scene,L=new THREE.Camera,p,Q,aa,fa=new THREE.Clock,Z,Y,S=!1,N=void 0,ba=new THREE.Vector2,T=new THREE.Vector3,U=new THREE.Vector3,ca=new THREE.Raycaster,ea=new THREE.Plane(void 0,-180),ha=new THREE.Sphere(void 0,100);window.onmousemove=function(b){ba.x=b.pageX/window.innerWidth*2-1;ba.y=2*-(b.pageY/window.innerHeight)+1};window.onmousedown=
function(b){0==b.button&&(S=!0)};window.onmouseup=function(b){0==b.button&&(S=!1,N=void 0)};var ia=Object.freeze({init:y,updating:function(){if(S){ca.setFromCamera(ba,Z);if(null!=ca.ray.intersectSphere(ha,T)&&(U.copy(T),void 0==N))for(var b=Infinity,a=0;a<Y.length;a++){var e=U.distanceTo(Y[a].original);e<b&&(b=e,N=a)}ea.normal.copy(Z.position).normalize();null!=ca.ray.intersectPlane(ea,T)&&U.copy(T);return S&&N?!0:!1}},mouse3d:U,get psel(){return N}}),t,z,K,V,k=[],O=[],W=new THREE.Vector3;window.onresize=
function(){var b=window.innerWidth,a=window.innerHeight;z.aspect=b/a;z.updateProjectionMatrix();t.setSize(b,a)};(function(){t=new THREE.WebGLRenderer({antialias:!0});t.setSize(window.innerWidth,window.innerHeight);t.setPixelRatio(window.devicePixelRatio);t.gammaOutput=!0;t.physicallyCorrectLights=!0;t.shadowMap.enabled=!0;t.shadowMap.type=THREE.PCFShadowMap;document.body.appendChild(t.domElement);K=new THREE.Scene;K.background=new THREE.Color(1184530);z=new THREE.PerspectiveCamera(60,window.innerWidth/
window.innerHeight,1,1E4);z.position.z=-350;z.position.y=-50;z.position.x=0;z.lookAt(new THREE.Vector3);var b=new THREE.IcosahedronBufferGeometry(100,5);b=THREE.BufferGeometryUtils.mergeVertices(b,1.5);V=b.attributes.position;for(var g=b.index,m=0,f=V.count;m<f;m++)W.fromBufferAttribute(V,m),k.push(new Particle(W.x,W.y,W.z));m=0;for(f=g.count/3;m<f;m++){var c=3*m,d=g.getX(c+0),h=g.getX(c+1);c=g.getX(c+2);k[d].faces.push([h,c]);k[h].faces.push([c,d]);k[c].faces.push([d,h]);if(!k[h].adj.includes(d)){var p=
k[d].original.distanceTo(k[h].original);k[d].adj.push(h);k[h].adj.push(d);O.push([d,h,p*p])}k[c].adj.includes(d)||(p=k[d].original.distanceTo(k[c].original),k[d].adj.push(c),k[c].adj.push(d),O.push([d,c,p*p]));k[c].adj.includes(h)||(d=k[h].original.distanceTo(k[c].original),k[h].adj.push(c),k[c].adj.push(h),O.push([h,c,d*d]))}g=0;for(m=O.length;g<m;g++)for(f=O[g],h=1;;){for(;void 0!==k[f[0]].colors[h];)h++;if(void 0===k[f[1]].colors[h]){f.push(h);k[f[0]].colors[h]=f[1];k[f[1]].colors[h]=f[0];break}else h++}g=
K;m=new THREE.MeshPhysicalMaterial({color:3750201,metalness:.9,roughness:.4,dithering:!0});f=new THREE.PlaneBufferGeometry(16E3,16E3);m=new THREE.Mesh(f,m);m.receiveShadow=!0;m.rotation.x+=.9*Math.PI;m.position.set(0,-100,2E3);g.add(m);g=K;m=new THREE.AmbientLight(4542533,0);f=new THREE.SpotLight(16616331,0,4E3,Math.PI/6,.2,.11);f.position.set(.9,.1,-.5).multiplyScalar(400);f.castShadow=!0;f.shadow.radius=20;f.shadow.camera.far=4E3;f.shadow.mapSize.height=4096;f.shadow.mapSize.width=4096;h=new THREE.SpotLight(7043828,
0,4E3,Math.PI/6,.2,.11);h.position.set(-.91,.1,-.5).multiplyScalar(400);h.castShadow=!0;h.shadow.radius=20;h.shadow.camera.far=4E3;h.shadow.mapSize.height=4096;h.shadow.mapSize.width=4096;d=new THREE.SpotLight(8750469,0,4E3,Math.PI/5.5,1.4,.02);d.position.set(0,0,-1).multiplyScalar(400);d.castShadow=!0;d.shadow.radius=5;d.shadow.camera.far=4E3;d.shadow.mapSize.height=4096;d.shadow.mapSize.width=4096;g.add(m,f,h,d);aa=[m,f,h,d];u(K,b);y(k,z);b=V;v=t;R=ia;n=Math.ceil(Math.sqrt(b.count));I.set(n,n);
g=new THREE.BufferGeometry;m=new Float32Array([-1,-1,3,-1,-1,3]);g.addAttribute("position",new THREE.BufferAttribute(m,2));A=new THREE.Mesh(g,B);A.frustumCulled=!1;J.add(A);F=l();w=l();M=l();r=l();X=l();P=Array.from({length:2},l);H=Array.from({length:3},l);g=new Float32Array(n*n*4);m=b.array.length;for(f=0;f<n;f++)for(h=0;h<n;h++){d=f*n*3+3*h;c=f*n*4+4*h;if(d>=m)break;g[c+0]=b.array[d+0];g[c+1]=b.array[d+1];g[c+2]=b.array[d+2]}b={};b.texture=new THREE.DataTexture(g,n,n,THREE.RGBAFormat,THREE.FloatType);
b.texture.minFilter=THREE.NearestFilter;b.texture.magFilter=THREE.NearestFilter;b.texture.needsUpdate=!0;b.texture.generateMipmaps=!1;b.texture.flipY=!1;a(b,F);a(F,M);a(F,r);a(e(k,0),P[0]);a(e(k,4),P[1]);a(q(k,0),H[0]);a(q(k,2),H[1]);a(q(k,4),H[2]);da()})()})();
